---
import { getCollection, render, type CollectionEntry } from 'astro:content';
import BlogLayout from '../../layouts/BlogLayout.astro';
import JsonLd from '../../components/ui/JsonLd.astro';
import { SITE } from '../../data/siteConfig';

export async function getStaticPaths() {
    const posts = await getCollection('blog');
    return posts.map((post) => ({
        params: { slug: post.id },
        props: { post },
    }));
}

interface Props {
    post: CollectionEntry<'blog'>;
}

const { post } = Astro.props as Props;
const { Content } = await render(post);

const blogPostSchema = {
    '@context': 'https://schema.org',
    '@type': 'BlogPosting',
    headline: post.data.title,
    description: post.data.description,
    datePublished: post.data.date.toISOString(),
    author: {
        '@type': 'Organization',
        name: post.data.author,
        url: SITE.url,
    },
    publisher: {
        '@type': 'Organization',
        name: SITE.name,
        url: SITE.url,
    },
    mainEntityOfPage: {
        '@type': 'WebPage',
        '@id': `${SITE.url}/blog/${post.id}`,
    },
};
---

<BlogLayout
    title={post.data.title}
    description={post.data.description}
    date={post.data.date}
    author={post.data.author}
    category={post.data.category}
    readTime={post.data.readTime}
    image={post.data.image}
>
    <Content />
    <JsonLd slot="head" data={blogPostSchema} />
</BlogLayout>
